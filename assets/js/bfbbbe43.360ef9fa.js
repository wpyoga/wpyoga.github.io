"use strict";(self.webpackChunkwpyoga_docusaurus_blog=self.webpackChunkwpyoga_docusaurus_blog||[]).push([[7607],{3905:function(e,t,n){n.d(t,{Zo:function(){return s},kt:function(){return m}});var o=n(7294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function a(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function l(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?a(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):a(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function i(e,t){if(null==e)return{};var n,o,r=function(e,t){if(null==e)return{};var n,o,r={},a=Object.keys(e);for(o=0;o<a.length;o++)n=a[o],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(o=0;o<a.length;o++)n=a[o],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var c=o.createContext({}),u=function(e){var t=o.useContext(c),n=t;return e&&(n="function"==typeof e?e(t):l(l({},t),e)),n},s=function(e){var t=u(e.components);return o.createElement(c.Provider,{value:t},e.children)},d={inlineCode:"code",wrapper:function(e){var t=e.children;return o.createElement(o.Fragment,{},t)}},p=o.forwardRef((function(e,t){var n=e.components,r=e.mdxType,a=e.originalType,c=e.parentName,s=i(e,["components","mdxType","originalType","parentName"]),p=u(n),m=r,g=p["".concat(c,".").concat(m)]||p[m]||d[m]||a;return n?o.createElement(g,l(l({ref:t},s),{},{components:n})):o.createElement(g,l({ref:t},s))}));function m(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var a=n.length,l=new Array(a);l[0]=p;var i={};for(var c in t)hasOwnProperty.call(t,c)&&(i[c]=t[c]);i.originalType=e,i.mdxType="string"==typeof e?e:r,l[1]=i;for(var u=2;u<a;u++)l[u]=n[u];return o.createElement.apply(null,l)}return o.createElement.apply(null,n)}p.displayName="MDXCreateElement"},9010:function(e,t,n){n.r(t),n.d(t,{frontMatter:function(){return i},contentTitle:function(){return c},metadata:function(){return u},assets:function(){return s},toc:function(){return d},default:function(){return m}});var o=n(3117),r=n(102),a=(n(7294),n(3905)),l=["components"],i={title:"Installing Nextcloud AIO on Docker",tags:["nextcloud","nextcloud-aio","docker"]},c=void 0,u={permalink:"/blog/2022/11/05/installing-nextcloud-aio-docker",editUrl:"https://github.com/wpyoga/wpyoga.github.io/edit/master/blog/2022-11-05-installing-nextcloud-aio-docker.md",source:"@site/blog/2022-11-05-installing-nextcloud-aio-docker.md",title:"Installing Nextcloud AIO on Docker",description:"I'm trying out self-hosted collaboration platforms. This time, I'm installing Nextcloud AIO on Docker. I'm using Caddy as a reverse proxy, because there will be multiple sites on the same server.",date:"2022-11-05T00:00:00.000Z",formattedDate:"November 5, 2022",tags:[{label:"nextcloud",permalink:"/blog/tags/nextcloud"},{label:"nextcloud-aio",permalink:"/blog/tags/nextcloud-aio"},{label:"docker",permalink:"/blog/tags/docker"}],truncated:!0,authors:[],nextItem:{title:"Hiding Ventoy's second partition",permalink:"/blog/2022/05/10/hiding-ventoy-second-partition"}},s={authorsImageUrls:[]},d=[],p={toc:d};function m(e){var t=e.components,n=(0,r.Z)(e,l);return(0,a.kt)("wrapper",(0,o.Z)({},p,n,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("p",null,"I'm trying out self-hosted collaboration platforms. This time, I'm installing Nextcloud AIO on Docker. I'm using Caddy as a reverse proxy, because there will be multiple sites on the same server."),(0,a.kt)("h1",{id:"installing-docker"},"Installing Docker"),(0,a.kt)("p",null,"This is the first time I'm installing docker, so I roughly followed the steps outlined here on ",(0,a.kt)("a",{parentName:"p",href:"https://www.digitalocean.com/community/tutorials/how-to-install-and-use-docker-on-ubuntu-22-04"},"DigitalOcean"),"."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-console"},'# curl https://download.docker.com/linux/ubuntu/gpg -o /etc/apt/trusted.gpg.d/docker.asc\n# echo "deb https://download.docker.com/linux/ubuntu jammy stable" > /etc/apt/sources.list.d/docker.list\n# apt update\n# apt install docker-ce\n# usermod -a -G docker wpyoga\n')),(0,a.kt)("h1",{id:"installing-nextcloud-aio"},"Installing Nextcloud AIO"),(0,a.kt)("p",null,"Then I roughly followed the steps outlined here on ",(0,a.kt)("a",{parentName:"p",href:"https://github.com/nextcloud/all-in-one/blob/main/reverse-proxy.md"},"Github"),"."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-console"},"$ docker run -d \\\n  --restart always \\\n  --sig-proxy=false \\\n  --publish 127.0.0.1:8080:8080 \\\n  -e APACHE_IP_BINDING=127.0.0.1 \\\n  -e APACHE_PORT=11000 \\\n  --name nextcloud-aio-mastercontainer \\\n  --volume nextcloud_aio_mastercontainer:/mnt/docker-aio-config \\\n  --volume /var/run/docker.sock:/var/run/docker.sock:ro \\\n  nextcloud/all-in-one:latest\n")),(0,a.kt)("p",null,'If you didn\'t do it right, remove the container and re-create it again. This is one of the quirks of Docker... container configuration is "immutable".'),(0,a.kt)("h1",{id:"nextcloud-initial-set-up"},"Nextcloud initial set up"),(0,a.kt)("p",null,"After the initial docker container is up and running, I set up a tunnel in order to access the configuration interface on ",(0,a.kt)("inlineCode",{parentName:"p"},"localhost:8080"),":"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-console"},"$ ssh my-server -L 8080:127.0.0.1:8080\n")),(0,a.kt)("p",null,"The configuration interface is easy to follow, and I enabled all the available services."),(0,a.kt)("h1",{id:"caddy-set-up"},"Caddy set up"),(0,a.kt)("p",null,"This is the configuration for the reverse proxy in ",(0,a.kt)("inlineCode",{parentName:"p"},"/etc/caddy/Caddyfile"),":"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"example.com {\n    reverse_proxy 127.0.0.1:11000\n}\n")),(0,a.kt)("p",null,"Caddy can be configured to use multiple upstream servers if needed."),(0,a.kt)("p",null,"To disable http, I also added this global configuration block right at the beginning of the file:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"{\n    auto_https disable_redirects\n}\n")))}m.isMDXComponent=!0}}]);