"use strict";(self.webpackChunkwpyoga_docusaurus_blog=self.webpackChunkwpyoga_docusaurus_blog||[]).push([[9151],{3905:function(e,t,n){n.d(t,{Zo:function(){return u},kt:function(){return d}});var o=n(7294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function a(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?a(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):a(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,o,r=function(e,t){if(null==e)return{};var n,o,r={},a=Object.keys(e);for(o=0;o<a.length;o++)n=a[o],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(o=0;o<a.length;o++)n=a[o],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var p=o.createContext({}),s=function(e){var t=o.useContext(p),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},u=function(e){var t=s(e.components);return o.createElement(p.Provider,{value:t},e.children)},c={inlineCode:"code",wrapper:function(e){var t=e.children;return o.createElement(o.Fragment,{},t)}},m=o.forwardRef((function(e,t){var n=e.components,r=e.mdxType,a=e.originalType,p=e.parentName,u=l(e,["components","mdxType","originalType","parentName"]),m=s(n),d=r,k=m["".concat(p,".").concat(d)]||m[d]||c[d]||a;return n?o.createElement(k,i(i({ref:t},u),{},{components:n})):o.createElement(k,i({ref:t},u))}));function d(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var a=n.length,i=new Array(a);i[0]=m;var l={};for(var p in t)hasOwnProperty.call(t,p)&&(l[p]=t[p]);l.originalType=e,l.mdxType="string"==typeof e?e:r,i[1]=l;for(var s=2;s<a;s++)i[s]=n[s];return o.createElement.apply(null,i)}return o.createElement.apply(null,n)}m.displayName="MDXCreateElement"},3410:function(e,t,n){n.r(t),n.d(t,{frontMatter:function(){return l},contentTitle:function(){return p},metadata:function(){return s},assets:function(){return u},toc:function(){return c},default:function(){return d}});var o=n(3117),r=n(102),a=(n(7294),n(3905)),i=["components"],l={title:"ThinkPad T14 TrackPoint & Linux",tags:["thinkpad","t14","trackpoint","linux","mouse"]},p=void 0,s={permalink:"/blog/2022/04/27/thinkpad-t14-trackpoint-linux",editUrl:"https://github.com/wpyoga/wpyoga.github.io/edit/master/blog/2022-04-27-thinkpad-t14-trackpoint-linux.md",source:"@site/blog/2022-04-27-thinkpad-t14-trackpoint-linux.md",title:"ThinkPad T14 TrackPoint & Linux",description:"On the ThinkPad T14, the TrackPoint does not work so well in Linux. Pointer movement is choppy and is just not smooth overall. When debugged using libinput debug-events, we can see that the polling rate is only about 30 Hz.",date:"2022-04-27T00:00:00.000Z",formattedDate:"April 27, 2022",tags:[{label:"thinkpad",permalink:"/blog/tags/thinkpad"},{label:"t14",permalink:"/blog/tags/t-14"},{label:"trackpoint",permalink:"/blog/tags/trackpoint"},{label:"linux",permalink:"/blog/tags/linux"},{label:"mouse",permalink:"/blog/tags/mouse"}],truncated:!0,authors:[],prevItem:{title:"Linux Mint OEM Kernel",permalink:"/blog/2022/04/27/linux-mint-oem-kernel"},nextItem:{title:"ThinkPad T14",permalink:"/blog/2022/04/27/thinkpad-t14"}},u={authorsImageUrls:[]},c=[],m={toc:c};function d(e){var t=e.components,n=(0,r.Z)(e,i);return(0,a.kt)("wrapper",(0,o.Z)({},m,n,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("p",null,"On the ThinkPad T14, the TrackPoint does not work so well in Linux. Pointer movement is choppy and is just not smooth overall. When debugged using ",(0,a.kt)("inlineCode",{parentName:"p"},"libinput debug-events"),", we can see that the polling rate is only about 30 Hz."),(0,a.kt)("p",null,"However, there is a workaround."),(0,a.kt)("h1",{id:"workaround"},"Workaround"),(0,a.kt)("p",null,"The trick is to reload the ",(0,a.kt)("inlineCode",{parentName:"p"},"psmouse")," module, and ",(0,a.kt)("a",{parentName:"p",href:"https://forums.lenovo.com/t5/Fedora/T14s-AMD-Trackpoint-almost-unusable/m-p/5064952?page=5#5494798"},"force it")," to use the ImPS/2 protocol."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-shell-session"},"$ sudo rmmod psmouse\n$ sudo modprobe psmouse proto=imps\n")),(0,a.kt)("p",null,"This works on Ubuntu-based distros. For Fedora, since the psmouse module is actually built into the kernel, the ",(0,a.kt)("inlineCode",{parentName:"p"},"proto")," parameter has to be passed on boot, appended to the Linux kernel command line:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-shell-session"},"psmouse.proto=imps\n")),(0,a.kt)("p",null,"In order to apply it on boot, create the file ",(0,a.kt)("inlineCode",{parentName:"p"},"/etc/default/grub.d/99_trackpoint.cfg"),":"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-sh"},'GRUB_CMDLINE_LINUX="psmouse.proto=imps"\n')),(0,a.kt)("p",null,"After applying this workaround, the polling rate goes up to about 80 Hz. However, there are two issues:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"Pointer movement is now too slow"),(0,a.kt)("li",{parentName:"ul"},"The TouchPad doesn't work at all")),(0,a.kt)("p",null,"I don't use the TouchPad, so it's not an issue for me. The slow pointer movement can be alleviated somewhat."),(0,a.kt)("h1",{id:"speed-up-pointer-movement"},"Speed up pointer movement"),(0,a.kt)("p",null,"In order to speed up the pointer movement, we can use a Coordinate Transformation Matrix:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",{parentName:"li",href:"https://askubuntu.com/a/1308058"},"https://askubuntu.com/a/1308058")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",{parentName:"li",href:"https://unix.stackexchange.com/a/177640"},"https://unix.stackexchange.com/a/177640")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",{parentName:"li",href:"https://wiki.ubuntu.com/X/InputCoordinateTransformation"},"https://wiki.ubuntu.com/X/InputCoordinateTransformation"))),(0,a.kt)("p",null,"You can play around with the matrix values, but this works best for me:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-shell-session"},"xinput set-prop 'PS/2 Synaptics TouchPad' 'Coordinate Transformation Matrix' 3.5 0 0 0 3.5 0 0 0 1\n")),(0,a.kt)("p",null,"Then, open the XFCE mouse settings and adjust the Acceleration settings. For me, ",(0,a.kt)("inlineCode",{parentName:"p"},"3.0")," gives me the best results."),(0,a.kt)("p",null,"The numbers above may vary between ThinkPad models, and even between different TrackPoint brands within the same model."),(0,a.kt)("p",null,"To make it permanent, create the file ",(0,a.kt)("inlineCode",{parentName:"p"},"/etc/X11/xorg.conf.d/99-trackpoint.conf"),":"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},'Section "InputClass"\n    Identifier "TrackPoint"\n    MatchProduct "PS/2 Synaptics TouchPad"\n    Option "TransformationMatrix" "3.5 0 0 0 3.5 0 0 0 1"\nEndSection\n')),(0,a.kt)("h1",{id:"notes"},"Notes"),(0,a.kt)("p",null,"On older ThinkPads, setting the ",(0,a.kt)("inlineCode",{parentName:"p"},"rate"),", ",(0,a.kt)("inlineCode",{parentName:"p"},"speed"),", and ",(0,a.kt)("inlineCode",{parentName:"p"},"sensitivity")," via sysfs works. However, it doesn't work on the T14."),(0,a.kt)("h1",{id:"todo"},"TODO"),(0,a.kt)("p",null,"The above is just a workaround, and you can even call it a kludge."),(0,a.kt)("p",null,"The proper fix might be two-fold:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"Fix the psmouse driver to recognize and work around the faulty TrackPoint"),(0,a.kt)("li",{parentName:"ul"},"Implement ",(0,a.kt)("a",{parentName:"li",href:"https://gitlab.freedesktop.org/libinput/libinput/-/issues/281"},"constant scale factor")," for libinput")),(0,a.kt)("p",null,"Note:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"This might be related to the fact that the T450s TrackPoint ",(0,a.kt)("a",{parentName:"li",href:"https://www.reddit.com/r/thinkpad/comments/fmt09q/trackpad_sometimes_interferes_with_trackpoint/"},"sometimes stutters"))))}d.isMDXComponent=!0}}]);