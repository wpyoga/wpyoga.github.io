"use strict";(self.webpackChunkwpyoga_docusaurus_blog=self.webpackChunkwpyoga_docusaurus_blog||[]).push([[9152],{3905:function(e,t,n){n.d(t,{Zo:function(){return c},kt:function(){return d}});var a=n(7294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function l(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},i=Object.keys(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var o=a.createContext({}),p=function(e){var t=a.useContext(o),n=t;return e&&(n="function"==typeof e?e(t):l(l({},t),e)),n},c=function(e){var t=p(e.components);return a.createElement(o.Provider,{value:t},e.children)},h={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},m=a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,i=e.originalType,o=e.parentName,c=s(e,["components","mdxType","originalType","parentName"]),m=p(n),d=r,u=m["".concat(o,".").concat(d)]||m[d]||h[d]||i;return n?a.createElement(u,l(l({ref:t},c),{},{components:n})):a.createElement(u,l({ref:t},c))}));function d(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var i=n.length,l=new Array(i);l[0]=m;var s={};for(var o in t)hasOwnProperty.call(t,o)&&(s[o]=t[o]);s.originalType=e,s.mdxType="string"==typeof e?e:r,l[1]=s;for(var p=2;p<i;p++)l[p]=n[p];return a.createElement.apply(null,l)}return a.createElement.apply(null,n)}m.displayName="MDXCreateElement"},3026:function(e,t,n){n.r(t),n.d(t,{frontMatter:function(){return s},contentTitle:function(){return o},metadata:function(){return p},assets:function(){return c},toc:function(){return h},default:function(){return d}});var a=n(3117),r=n(102),i=(n(7294),n(3905)),l=["components"],s={title:"Using a `.bashrc.d` directory instead of just `.bashrc`",tags:["bash","bashrc","bashrc.d","shell"]},o=void 0,p={permalink:"/blog/2021/07/10/bashrc-directory",editUrl:"https://github.com/wpyoga/wpyoga.github.io/edit/master/blog/2021-07-10-bashrc-directory.md",source:"@site/blog/2021-07-10-bashrc-directory.md",title:"Using a `.bashrc.d` directory instead of just `.bashrc`",description:"When we install a new development environment, the installer will usually modify /.bashrc or /.profile. However, this is not very clean, because sometimes the entries are not removed when the development environment is uninstalled.",date:"2021-07-10T00:00:00.000Z",formattedDate:"July 10, 2021",tags:[{label:"bash",permalink:"/blog/tags/bash"},{label:"bashrc",permalink:"/blog/tags/bashrc"},{label:"bashrc.d",permalink:"/blog/tags/bashrc-d"},{label:"shell",permalink:"/blog/tags/shell"}],truncated:!0,authors:[],prevItem:{title:"Manual Profiling of Bash Script Execution",permalink:"/blog/2021/07/11/manual-profiling-bash-script"},nextItem:{title:"GitHub `main` branch",permalink:"/blog/2021/06/16/github-main-branch"}},c={authorsImageUrls:[]},h=[{value:"Why use a directory?",id:"why-use-a-directory",children:[],level:2},{value:"Historical precedence",id:"historical-precedence",children:[],level:2},{value:"Further information",id:"further-information",children:[],level:2},{value:"Simple implementation",id:"simple-implementation",children:[],level:2},{value:"Self-cleaning implementation",id:"self-cleaning-implementation",children:[],level:2}],m={toc:h};function d(e){var t=e.components,n=(0,r.Z)(e,l);return(0,i.kt)("wrapper",(0,a.Z)({},m,n,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("p",null,"When we install a new development environment, the installer will usually modify ",(0,i.kt)("inlineCode",{parentName:"p"},"~/.bashrc")," or ",(0,i.kt)("inlineCode",{parentName:"p"},"~/.profile"),". However, this is not very clean, because sometimes the entries are not removed when the development environment is uninstalled."),(0,i.kt)("h2",{id:"why-use-a-directory"},"Why use a directory?"),(0,i.kt)("p",null,"By using a directory, we can add and remove customizations by simply adding and removing files. Consider this example: when we install ",(0,i.kt)("a",{parentName:"p",href:"https://sdkman.io/"},"SDKMAN!"),", the installer adds these lines to ",(0,i.kt)("inlineCode",{parentName:"p"},"~/.bashrc")," by default:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-shell"},'#THIS MUST BE AT THE END OF THE FILE FOR SDKMAN TO WORK!!!\nexport SDKMAN_DIR="/home/william/.sdkman"\n[[ -s "/home/william/.sdkman/bin/sdkman-init.sh" ]] && source "/home/william/.sdkman/bin/sdkman-init.sh"\n')),(0,i.kt)("p",null,"Then when we uninstall SDKMAN!, we have to open the ",(0,i.kt)("inlineCode",{parentName:"p"},"~/.bashrc")," file and remove the lines that were added."),(0,i.kt)("p",null,"The same thing happens with ",(0,i.kt)("inlineCode",{parentName:"p"},"nvm"),", a popular version manager for ",(0,i.kt)("inlineCode",{parentName:"p"},"Node.js"),"."),(0,i.kt)("p",null,"Some installers even had to let the user edit ",(0,i.kt)("inlineCode",{parentName:"p"},"~/.bashrc")," by hand."),(0,i.kt)("h2",{id:"historical-precedence"},"Historical precedence"),(0,i.kt)("p",null,"Actually, this is not a new idea. The directory ",(0,i.kt)("inlineCode",{parentName:"p"},"/etc/profile.d")," exists for the same reason, albeit for software installed directly onto the system. The contents of this directory is sourced in by ",(0,i.kt)("inlineCode",{parentName:"p"},"/etc/profile"),", as seen in the snippet below:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-shell"},"if [ -d /etc/profile.d ]; then\n  for i in /etc/profile.d/*.sh; do\n    if [ -r $i ]; then\n      . $i\n    fi\n  done\n  unset i\nfi\n")),(0,i.kt)("p",null,"Also, someone else has ",(0,i.kt)("a",{parentName:"p",href:"https://waxzce.medium.com/use-bashrc-d-directory-instead-of-bloated-bashrc-50204d5389ff"},"blogged about this topic")," on Medium. However, some Medium articles are blocked by a paywall, and I'm not sure if that article is a paid article, or will be made a paid article at some point in the future, so I'm making this blog post instead. In contrast, this blog will always be free, at least as long as GitHub continues to provide GitHub Pages for free."),(0,i.kt)("h2",{id:"further-information"},"Further information"),(0,i.kt)("p",null,(0,i.kt)("inlineCode",{parentName:"p"},"~/.bashrc.d")),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"(2002) ",(0,i.kt)("a",{parentName:"li",href:"https://bugs.gentoo.org/4854"},"https://bugs.gentoo.org/4854")),(0,i.kt)("li",{parentName:"ul"},"(2011) ",(0,i.kt)("a",{parentName:"li",href:"http://blogs.perl.org/users/chisel/2011/08/managing-my-shell-setup.html"},"http://blogs.perl.org/users/chisel/2011/08/managing-my-shell-setup.html")),(0,i.kt)("li",{parentName:"ul"},"(2012) ",(0,i.kt)("a",{parentName:"li",href:"https://groups.google.com/g/linux.debian.bugs.dist/c/1mDbDViPFFQ"},"https://groups.google.com/g/linux.debian.bugs.dist/c/1mDbDViPFFQ")),(0,i.kt)("li",{parentName:"ul"},"(2012) ",(0,i.kt)("a",{parentName:"li",href:"https://bugs.debian.org/cgi-bin/bugreport.cgi?bug=675008"},"https://bugs.debian.org/cgi-bin/bugreport.cgi?bug=675008")),(0,i.kt)("li",{parentName:"ul"},"(2015) ",(0,i.kt)("a",{parentName:"li",href:"https://freesoft.dev/program/31617374"},"https://freesoft.dev/program/31617374")),(0,i.kt)("li",{parentName:"ul"},"(2015) ",(0,i.kt)("a",{parentName:"li",href:"https://blog.sanctum.geek.nz/tag/bashrc-d/"},"https://blog.sanctum.geek.nz/tag/bashrc-d/")),(0,i.kt)("li",{parentName:"ul"},"(2016) ",(0,i.kt)("a",{parentName:"li",href:"https://lsbbugs.linuxfoundation.org/show_bug.cgi?id=4167"},"https://lsbbugs.linuxfoundation.org/show_bug.cgi?id=4167")),(0,i.kt)("li",{parentName:"ul"},"(2016) ",(0,i.kt)("a",{parentName:"li",href:"https://github.com/jdcapa/bashrc.d"},"https://github.com/jdcapa/bashrc.d")),(0,i.kt)("li",{parentName:"ul"},"(2017) ",(0,i.kt)("a",{parentName:"li",href:"https://waxzce.medium.com/use-bashrc-d-directory-instead-of-bloated-bashrc-50204d5389ff"},"https://waxzce.medium.com/use-bashrc-d-directory-instead-of-bloated-bashrc-50204d5389ff")),(0,i.kt)("li",{parentName:"ul"},"(2017) ",(0,i.kt)("a",{parentName:"li",href:"https://github.com/oskar404/.bashrc.d"},"https://github.com/oskar404/.bashrc.d")),(0,i.kt)("li",{parentName:"ul"},"(2019) ",(0,i.kt)("a",{parentName:"li",href:"https://sneak.berlin/20191011/stupid-unix-tricks/"},"https://sneak.berlin/20191011/stupid-unix-tricks/")),(0,i.kt)("li",{parentName:"ul"},"(2019) ",(0,i.kt)("a",{parentName:"li",href:"https://bugzilla.redhat.com/show_bug.cgi?id=1726397"},"https://bugzilla.redhat.com/show_bug.cgi?id=1726397")),(0,i.kt)("li",{parentName:"ul"},"(2019) ",(0,i.kt)("a",{parentName:"li",href:"https://bugs.debian.org/cgi-bin/bugreport.cgi?bug=931353"},"https://bugs.debian.org/cgi-bin/bugreport.cgi?bug=931353")),(0,i.kt)("li",{parentName:"ul"},"(2019) ",(0,i.kt)("a",{parentName:"li",href:"https://bugs.launchpad.net/ubuntu/+source/bash/+bug/1835077"},"https://bugs.launchpad.net/ubuntu/+source/bash/+bug/1835077")),(0,i.kt)("li",{parentName:"ul"},"(2020) ",(0,i.kt)("a",{parentName:"li",href:"https://source.arknet.ch/fmorgner/dotfiles/-/tree/16f950b2ce140a81e45bcad99ea142a6f3f7a7f2/bashrc.d"},"https://source.arknet.ch/fmorgner/dotfiles/-/tree/16f950b2ce140a81e45bcad99ea142a6f3f7a7f2/bashrc.d")),(0,i.kt)("li",{parentName:"ul"},"(2020) ",(0,i.kt)("a",{parentName:"li",href:"https://dev.to/swiknaba/how-to-organize-your-bash-profile-20eb"},"https://dev.to/swiknaba/how-to-organize-your-bash-profile-20eb")),(0,i.kt)("li",{parentName:"ul"},"(2020) ",(0,i.kt)("a",{parentName:"li",href:"https://lab.retarded.farm/zappel/zGentoo-playground/-/tree/22e288c8b0ed166d1bc0050f9f00e3fe4708b0d4/etc/bash/bashrc.d"},"https://lab.retarded.farm/zappel/zGentoo-playground/-/tree/22e288c8b0ed166d1bc0050f9f00e3fe4708b0d4/etc/bash/bashrc.d")),(0,i.kt)("li",{parentName:"ul"},"(2021) ",(0,i.kt)("a",{parentName:"li",href:"https://blog.jbriault.fr/bashrc-d/"},"https://blog.jbriault.fr/bashrc-d/")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"https://g.gg42.eu/framagit/conf-99-basic_config_debian/commit/56f82be3cc0f98af05989f34f44817e90d0e814f"},"https://g.gg42.eu/framagit/conf-99-basic_config_debian/commit/56f82be3cc0f98af05989f34f44817e90d0e814f")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"https://write.as/bpsylevc6lliaspe"},"https://write.as/bpsylevc6lliaspe")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"https://timnash.co.uk/bashing-my-bashrc-productivity-fridays/"},"https://timnash.co.uk/bashing-my-bashrc-productivity-fridays/"))),(0,i.kt)("p",null,(0,i.kt)("inlineCode",{parentName:"p"},"/etc/profile.d"),":"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"https://eng.libretexts.org/Bookshelves/Computer_Science/Operating_Systems/Linux_-_The_Penguin_Marches_On_(McClanahan)/02%3A_User_Group_Administration/5.03%3A_System_Wide_User_Profiles/5.03.2_System_Wide_User_Profiles%3A_The_etc-profile.d_Directory"},"https://eng.libretexts.org/Bookshelves/Computer_Science/Operating_Systems/Linux_-_The_Penguin_Marches_On_(McClanahan)/02%3A_User_Group_Administration/5.03%3A_System_Wide_User_Profiles/5.03.2_System_Wide_User_Profiles%3A_The_etc-profile.d_Directory")),(0,i.kt)("li",{parentName:"ul"},"(2014) ",(0,i.kt)("a",{parentName:"li",href:"https://askubuntu.com/questions/438150/why-are-scripts-in-etc-profile-d-being-ignored-system-wide-bash-aliases"},"https://askubuntu.com/questions/438150/why-are-scripts-in-etc-profile-d-being-ignored-system-wide-bash-aliases"))),(0,i.kt)("p",null,(0,i.kt)("inlineCode",{parentName:"p"},"profile")," and ",(0,i.kt)("inlineCode",{parentName:"p"},"bashrc")," in general:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"(2013) ",(0,i.kt)("a",{parentName:"li",href:"https://bencane.com/2013/09/16/understanding-a-little-more-about-etcprofile-and-etcbashrc/"},"https://bencane.com/2013/09/16/understanding-a-little-more-about-etcprofile-and-etcbashrc/")),(0,i.kt)("li",{parentName:"ul"},"(2017) ",(0,i.kt)("a",{parentName:"li",href:"https://scriptingosx.com/2017/04/about-bash_profile-and-bashrc-on-macos/"},"https://scriptingosx.com/2017/04/about-bash_profile-and-bashrc-on-macos/"))),(0,i.kt)("h2",{id:"simple-implementation"},"Simple implementation"),(0,i.kt)("p",null,"To implement the ",(0,i.kt)("inlineCode",{parentName:"p"},"~/.bashrc.d")," scheme, we first need to make that directory, and then move the original rc file into that directory:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-shell"},"$ cd\n$ mkdir .bashrc.d\n$ mv -i .bashrc .bashrc.d/00-default.bashrc\n")),(0,i.kt)("p",null,"After that, we need to make a replacement ",(0,i.kt)("inlineCode",{parentName:"p"},"~/.bashrc")," file that sources all the scripts inside ",(0,i.kt)("inlineCode",{parentName:"p"},"~/.bashrc.d"),". This is basically an adaptation of the code snippet in ",(0,i.kt)("inlineCode",{parentName:"p"},"/etc/profile"),":"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-shell"},'for i in "${HOME}/.bashrc.d"/[0-9][0-9]-*.bashrc; do\n  if [ -r "$i" ]; then\n    . "$i"\n  fi\ndone\nunset i\n')),(0,i.kt)("p",null,"Note that we don't need to test if the directory is present -- if it's not present, then ",(0,i.kt)("inlineCode",{parentName:"p"},"i")," will look something like ",(0,i.kt)("inlineCode",{parentName:"p"},"/home/william/.bashrc.d/*.bashrc"),", so the following test for readability will fail anyway."),(0,i.kt)("p",null,"With this scheme, when you install a new software or SDK into your personal home directory, just add a new file named something like ",(0,i.kt)("inlineCode",{parentName:"p"},"50-file.bashrc")," in ",(0,i.kt)("inlineCode",{parentName:"p"},"~/.bashrc.d")," and it will be sourced in during shell startup."),(0,i.kt)("h2",{id:"self-cleaning-implementation"},"Self-cleaning implementation"),(0,i.kt)("p",null,"With the above implementation, some scripts will still directly modify ",(0,i.kt)("inlineCode",{parentName:"p"},"~/.bashrc"),", and ignore the ",(0,i.kt)("inlineCode",{parentName:"p"},"~/.bashrc.d")," directory. We can actually make a self-cleaning implementation, so that lines appended to ",(0,i.kt)("inlineCode",{parentName:"p"},"~/.bashrc")," will automatically be moved into ",(0,i.kt)("inlineCode",{parentName:"p"},"~/.bashrc.d"),"."),(0,i.kt)("p",null,"An easy way to do that, is by using markers in ",(0,i.kt)("inlineCode",{parentName:"p"},"~/.bashrc"),". The markers tell us when the original file starts and ends, so that we can move all the other content into ",(0,i.kt)("inlineCode",{parentName:"p"},"~/.bashrc.d"),"."),(0,i.kt)("p",null,"To achieve this, we modify ",(0,i.kt)("inlineCode",{parentName:"p"},"~/.bashrc")," even further:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-shell"},'### BASHRC START\nfor i in "${HOME}/.bashrc.d"/[0-9][0-9]-*.bashrc; do\n  if [ -r "$i" ]; then\n    . "$i"\n  fi\ndone\nunset i\n\nif which mktemp >/dev/null 2>&1; then\n  BASHRC_BEFORE="$(mktemp "${HOME}/.bashrc.d/50-new-XXXXXX")"\n  BASHRC_AFTER="$(mktemp "${HOME}/.bashrc.d/50-new-XXXXXX")"\n  BASHRC_TEMP="$(mktemp "${HOME}/.bashrc-XXXXXX")"\n  BASHRC_MODE=before\n  while IFS= read -r LINE; do\n    if [ "${LINE}" = \'### BASHRC START\' ]; then\n      BASHRC_MODE=bashrc\n    elif [ "${LINE}" = \'### BASHRC END\' ]; then\n      BASHRC_MODE=after\n      continue\n    fi\n\n    if [ "${BASHRC_MODE}" = \'before\' ]; then\n      printf \'%s\\n\' "${LINE}" >>"${BASHRC_BEFORE}"\n    elif [ "${BASHRC_MODE}" = \'after\' ]; then\n      printf \'%s\\n\' "${LINE}" >>"${BASHRC_AFTER}"\n    else\n      printf \'%s\\n\' "${LINE}" >>"${BASHRC_TEMP}"\n    fi\n  done <"${HOME}/.bashrc"\n  # this marker is never printed in the loop\n  echo \'### BASHRC END\' >>"${BASHRC_TEMP}"\n  mv "${BASHRC_TEMP}" "${HOME}/.bashrc"\n\n  if [ -s "${BASHRC_BEFORE}" -o -s "${BASHRC_AFTER}" ]; then\n    echo "~/.bashrc has been modified. Check the following files for customizations:"\n    [ -s "${BASHRC_BEFORE}" ] && echo "* ${BASHRC_BEFORE}"\n    [ -s "${BASHRC_AFTER}" ] && echo "* ${BASHRC_AFTER}"\n  else\n    [ ! -s "${BASHRC_BEFORE}" ] && rm "${BASHRC_BEFORE}"\n    [ ! -s "${BASHRC_AFTER}" ] && rm "${BASHRC_AFTER}"\n  fi\n  unset BASHRC_BEFORE BASHRC_AFTER BASHRC_TEMP BASHRC_MODE\nfi\n### BASHRC END\n')),(0,i.kt)("p",null,"This looks bloated and unnecessary. But this section takes only 9 ms on my laptop (i5-5200u), so it may not be so slow after all. Still, if you think it's too complicated, you can use the ",(0,i.kt)("a",{parentName:"p",href:"#simple-implementation"},"simple implementation")," instead."))}d.isMDXComponent=!0}}]);