"use strict";(self.webpackChunkwpyoga_docusaurus_blog=self.webpackChunkwpyoga_docusaurus_blog||[]).push([[1136],{3905:function(e,t,n){n.d(t,{Zo:function(){return u},kt:function(){return m}});var a=n(7294);function l(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){l(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function i(e,t){if(null==e)return{};var n,a,l=function(e,t){if(null==e)return{};var n,a,l={},r=Object.keys(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||(l[n]=e[n]);return l}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(l[n]=e[n])}return l}var s=a.createContext({}),c=function(e){var t=a.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):o(o({},t),e)),n},u=function(e){var t=c(e.components);return a.createElement(s.Provider,{value:t},e.children)},p={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},d=a.forwardRef((function(e,t){var n=e.components,l=e.mdxType,r=e.originalType,s=e.parentName,u=i(e,["components","mdxType","originalType","parentName"]),d=c(n),m=l,h=d["".concat(s,".").concat(m)]||d[m]||p[m]||r;return n?a.createElement(h,o(o({ref:t},u),{},{components:n})):a.createElement(h,o({ref:t},u))}));function m(e,t){var n=arguments,l=t&&t.mdxType;if("string"==typeof e||l){var r=n.length,o=new Array(r);o[0]=d;var i={};for(var s in t)hasOwnProperty.call(t,s)&&(i[s]=t[s]);i.originalType=e,i.mdxType="string"==typeof e?e:l,o[1]=i;for(var c=2;c<r;c++)o[c]=n[c];return a.createElement.apply(null,o)}return a.createElement.apply(null,n)}d.displayName="MDXCreateElement"},3189:function(e,t,n){n.r(t),n.d(t,{frontMatter:function(){return i},contentTitle:function(){return s},metadata:function(){return c},assets:function(){return u},toc:function(){return p},default:function(){return m}});var a=n(3117),l=n(102),r=(n(7294),n(3905)),o=["components"],i={title:"Enabling IPv6 on Oracle Cloud Instance",tags:["oracle","cloud","instance","oci","ipv6","firewall","firewalld","dhcp"]},s=void 0,c={permalink:"/blog/2021/10/30/oracle-cloud-instance-ipv6",editUrl:"https://github.com/wpyoga/wpyoga.github.io/edit/master/blog/2021-10-30-oracle-cloud-instance-ipv6.md",source:"@site/blog/2021-10-30-oracle-cloud-instance-ipv6.md",title:"Enabling IPv6 on Oracle Cloud Instance",description:"I have a couple of always-free compute instances on Oracle Cloud. By default, each instance gets an IPv4 address, and IPv6 is not enabled.",date:"2021-10-30T00:00:00.000Z",formattedDate:"October 30, 2021",tags:[{label:"oracle",permalink:"/blog/tags/oracle"},{label:"cloud",permalink:"/blog/tags/cloud"},{label:"instance",permalink:"/blog/tags/instance"},{label:"oci",permalink:"/blog/tags/oci"},{label:"ipv6",permalink:"/blog/tags/ipv-6"},{label:"firewall",permalink:"/blog/tags/firewall"},{label:"firewalld",permalink:"/blog/tags/firewalld"},{label:"dhcp",permalink:"/blog/tags/dhcp"}],truncated:!0,authors:[],prevItem:{title:"Deciphering Aptitude Search Results",permalink:"/blog/2022/01/19/deciphering-aptitude-search-results"},nextItem:{title:"Using DNF on an IPv6-only host",permalink:"/blog/2021/10/26/dnf-ipv6"}},u={authorsImageUrls:[]},p=[{value:"Enable and assign IPv6 to the instance",id:"enable-and-assign-ipv6-to-the-instance",children:[],level:2},{value:"Obtain the IPv6 address from the instance",id:"obtain-the-ipv6-address-from-the-instance",children:[{value:"Oracle Linux 7.9",id:"oracle-linux-79",children:[],level:3},{value:"Oracle Linux 8",id:"oracle-linux-8",children:[],level:3},{value:"Ubuntu",id:"ubuntu",children:[],level:3}],level:2}],d={toc:p};function m(e){var t=e.components,n=(0,l.Z)(e,o);return(0,r.kt)("wrapper",(0,a.Z)({},d,n,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("p",null,"I have a couple of always-free compute instances on Oracle Cloud. By default, each instance gets an IPv4 address, and IPv6 is not enabled."),(0,r.kt)("p",null,"I tried enabling IPv6 using ",(0,r.kt)("a",{parentName:"p",href:"https://blog.51sec.org/2021/09/enable-ipv6-on-oracle-cloud.html"},"instructions I found on the Internet"),", but:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"it doesn't work for my Oracle Linux 8.4 instance"),(0,r.kt)("li",{parentName:"ul"},"even if it did, we have to manually obtain the IPv6 address using ",(0,r.kt)("inlineCode",{parentName:"li"},"/etc/rc.local")," -- this doesn't seem to be the best practice, especially since this is a systemd distro")),(0,r.kt)("p",null,"Hey, I'm all for simplicity and I love SysV init scripts, but if the distro is a systemd distro, then I'll use systemd.\nJust like the reason why I have an Oracle Linux instance on Oracle Cloud -- it's supposed to be the best-supported OS on their cloud.\nYes, it's just another clone of RHEL, but I thought it would somehow be better tuned for Oracle Cloud environment..."),(0,r.kt)("p",null,"Anyway, I do have a Ubuntu instance on Oracle Cloud, and it's much easier to set up and figure out as you can see below."),(0,r.kt)("h2",{id:"enable-and-assign-ipv6-to-the-instance"},"Enable and assign IPv6 to the instance"),(0,r.kt)("p",null,"This is done from on the cloud infrastructure, and can be easily done using the ",(0,r.kt)("a",{parentName:"p",href:"https://cloud.oracle.com/"},"Cloud Console"),". These instructions are taken from ",(0,r.kt)("a",{parentName:"p",href:"https://blog.51sec.org/2021/09/enable-ipv6-on-oracle-cloud.html"},"the aforementioned article"),"."),(0,r.kt)("p",null,"Once logged in to the Cloud Console, open the instance to be configured and perform the following actions:"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Configure VCN:"),(0,r.kt)("ol",{parentName:"li"},(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"CIDR Blocks: add an IPv6 CIDR block")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Subnets: Edit -> enable the CIDR block")))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Configure Security List:"),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"Ingress Rules: add IPv6-ICMP type 128 to allow incoming ping (from ",(0,r.kt)("inlineCode",{parentName:"p"},"::/0"),")")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"Egress Rules: allow traffic of all protocols to all destinations (",(0,r.kt)("inlineCode",{parentName:"p"},"::/0"),")")))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Configure Route Table: Route Rules -> add IPv6 route rule to ",(0,r.kt)("inlineCode",{parentName:"p"},"::/0")," targeting the default Internet Gateway")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Configure VNIC: IPv6 Addresses -> assign an IPv6 address"))),(0,r.kt)("p",null,"At this point, an IPv6 address has been assigned to the instance, and the network has been set up properly."),(0,r.kt)("p",null,"If you add new instances into the same VCN, then you would only need to assign a new IPv6 address to the VNIC, no need to reconfigure the other resources (CIDR Blocks, subnets, security lists, route table)."),(0,r.kt)("h2",{id:"obtain-the-ipv6-address-from-the-instance"},"Obtain the IPv6 address from the instance"),(0,r.kt)("p",null,"Next, obtain the IPv6 address from within the instance itself."),(0,r.kt)("h3",{id:"oracle-linux-79"},"Oracle Linux 7.9"),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"dhcpv6-client")," service is already enabled by default."),(0,r.kt)("p",null,"Create a new file ",(0,r.kt)("inlineCode",{parentName:"p"},"/etc/cloud/cloud.cfg.d/99_ipv6.cfg"),":"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yaml"},"network:\n  version: 2\n  ethernets:\n    enp0s3:\n      dhcp: true\n      dhcp6: true\n")),(0,r.kt)("p",null,"TODO: somehow my Ampere instance doesn't work yet"),(0,r.kt)("h3",{id:"oracle-linux-8"},"Oracle Linux 8"),(0,r.kt)("p",null,"SSH into the instance, and ",(0,r.kt)("a",{parentName:"p",href:"https://docs.oracle.com/en-us/iaas/Content/Network/Concepts/ipv6.htm#os_config"},"add DHCPv6 service")," to the firewall:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell-session"},"$ sudo firewall-cmd --add-service=dhcpv6-client\n")),(0,r.kt)("p",null,"Check that the firewall setting have been applied properly:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell-session"},"$ sudo firewall-cmd --list-all\n")),(0,r.kt)("p",null,"Tell NetworkManager to obtain the IPv6 address:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell-session"},"$ sudo systemctl restart NetworkManager\n")),(0,r.kt)("p",null,"Wait a few seconds, and then check to see that the IPv6 address has been obtained successfully.\nWe need to wait a few seconds because dhclient needs some time to obtain and then apply the IPv6 address."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell-session"},"$ ip add\n")),(0,r.kt)("p",null,"If all is well, make the firewall rule permanent:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell-session"},"$ sudo firewall-cmd --add-service=dhcpv6-client --permanent\n")),(0,r.kt)("p",null,"I actually wasted a few hours trying to find this information.\nIt turns out DHCP was blocked by default and we need to allow it.\nNot sure why most people recommend setting the IPv6 statically..."),(0,r.kt)("p",null,"Moral of the story: read the official documentation!"),(0,r.kt)("h3",{id:"ubuntu"},"Ubuntu"),(0,r.kt)("p",null,"SSH into the instance, and reload the network configuration:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell-session"},"$ sudo systemctl restart systemd-networkd\n")),(0,r.kt)("p",null,"That's it. It's much simpler isn't it? :)"),(0,r.kt)("p",null,"P.S. on my Ampere instance, the IPv6 is applied almost as soon as I configured it."))}m.isMDXComponent=!0}}]);